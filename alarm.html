<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>calendar</title>
<link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/alarm.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/locale/ko.js"></script>
<script>

	var select_time = '';
	var $alarmList;
	var localSt = localStorage.getItem('alram');

	window.onload = function(){
		setInterval(()=>{
			
			// for(var i=0; alarm.length; i++){
			// 	// var test = moment('2019-03-02 14:51:00');
			// 	var test = moment(alarm[i]);
				
			// 	if(test != null && test.isBefore(time)){
			// 		alarm.splice(i, 1);
			// 		console.log("알림!!!");
			// 	}
				
			// }
			a_time();
			
		}, 1000);

		$input = $('#input');
		$alarmList = $('#alarm_list');

		alarm_fuc();
		cal_fuc(now_month);
	}

	function a_time(){
		var time = moment();
		
		alarm = JSON.parse(localSt);
		select_time = time.format('LTS');
		$('#a_time').text(select_time);
		
		var al_str = '';
		var change_flag = false;

		if(localSt != undefined && localSt != ''){
			for(var j=0; j<alarm.length; j++){
				if(alarm[j] == select_time){
					alert('alram');
					alarm.splice(j, 1);
					change_flag = true;
				}
			}
		}
		if(change_flag){
			localStorage.setItem('alram', JSON.stringify(alarm));
			localSt = JSON.stringify(alarm);
			for(var j=0; j<alarm.length; j++){
				al_str += `<li>${alarm[j]}</li>`
			}

			$alarmList.html(al_str);
		}

	}

	function alarm_fuc(){
		var time = moment();
		var $ai_btn = $('#ai_btn');
		
		select_time = time.format('LTS');

		$('#a_time').text(select_time);

		$ai_btn.on('click', function(){
			alarm_save();
		});

		alarm = JSON.parse(localSt);

		var al_num = '';

		for(var i=0; i<60; i++){
			if(i < 10){
				i = '0' + i;
			}
			al_str += `<option>${i}</option>`
		}

		$('#hours').html(al_str);
		$('#minutes').html(al_str);
		$('#second').html(al_str);

		var al_str = '';

		if(localSt != undefined && localSt != ''){
			for(var j=0; j<alarm.length; j++){
				al_str += `<li>${alarm[j]}</li>`
			}
		}
		
		$alarmList.html(al_str);
	}

	function alarm_save(){
		var alarm = [];
		var $aInput = $('#a_input');
		
		if(localSt != undefined && localSt != ''){
			alarm = JSON.parse(localSt);
			alarm.push($aInput.val());
		}else{
			alarm[0] = $aInput.val();
		}
		
		localStorage.setItem('alram', JSON.stringify(alarm));
		localSt = JSON.stringify(alarm);

		var al_str = '';

		for(var j=0; j<alarm.length; j++){
			al_str += `<li>${alarm[j]}</li>`
		}

		$alarmList.html(al_str);
		console.log(alarm);
		
	}

</script>
</head>
<body>
<div class="wrap">
	<div id="alarm">
		<div id="a_time"></div>
		<div id="alarm_list">
			<ul></ul>
		</div>
		<div id="a_input_line">
			<select id="ampm">
				<option>오전</option>
				<option>오후</option>
			</select>
			<select id="hours"></select>
			<select id="minutes"></select>
			<select id="second"></select>
		</div>
		<div class="b_btn">
			<button type="button" id="ai_btn">Set Alarm</button>
		</div>
	</div>
</div>
</body>
</html>